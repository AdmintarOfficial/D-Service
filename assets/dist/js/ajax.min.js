var HttPRequest = false;

// Cookie
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function doCallLogin() {
    HttPRequest = false;
    if (window.XMLHttpRequest) { // Mozilla, Safari,...
        HttPRequest = new XMLHttpRequest();
        if (HttPRequest.overrideMimeType) {
            HttPRequest.overrideMimeType('text/html');
        }
    } else if (window.ActiveXObject) { // IE
        try {
            HttPRequest = new ActiveXObject("Msxml2.XMLHTTP");
        } catch (e) {
            try {
                HttPRequest = new ActiveXObject("Microsoft.XMLHTTP");
            } catch (e) {}
        }
    } 
    if (!HttPRequest) {
        alert('Cannot create XMLHTTP instance');
        return false;
    }
    var url = '/เข้าสู่ระบบ/';
    var pmeters = "tuser=" + encodeURI(document.getElementById("user").value) +
        "&tpass=" + encodeURI(document.getElementById("pass").value) +
        "&tlogin=" + encodeURI(document.getElementById("login").value) +
        "&tcsrftoken=" + encodeURI(document.querySelector('[name=csrfmiddlewaretoken]').value);
    HttPRequest.open('POST',url,true);

    HttPRequest.setRequestHeader("X-CSRFToken", encodeURI(document.querySelector('[name=csrfmiddlewaretoken]').value));
    HttPRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    HttPRequest.send(pmeters);
    
    HttPRequest.onreadystatechange = function() {
        // SweetAlert2
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 5000
        });
        
        // Loading Request
        if(HttPRequest.readyState == 3) {
            Toast.fire({
                icon: 'info',
                title: 'กำลังโหลด...'
            })
        }
        // Return Request
        if(HttPRequest.readyState == 4)
        {
            var Jsonresponse = JSON.parse(HttPRequest.responseText);
            
            if(Jsonresponse.status == 'Y') {
                window.location = Jsonresponse.url;
            } else if(Jsonresponse.status == 'N') {
                Toast.fire({
                    icon: Jsonresponse.values,
                    title: Jsonresponse.alertify
                })
            } else {
                Toast.fire({
                    icon: 'question',
                    title: HttPRequest.responseText
                })
            }
        }
    }
}

function doCallAddCart() {
    HttPRequest = false;
    if (window.XMLHttpRequest) { // Mozilla, Safari,...
        HttPRequest = new XMLHttpRequest();
        if (HttPRequest.overrideMimeType) {
            HttPRequest.overrideMimeType('text/html');
        }
    } else if (window.ActiveXObject) { // IE
        try {
            HttPRequest = new ActiveXObject("Msxml2.XMLHTTP");
        } catch (e) {
            try {
                HttPRequest = new ActiveXObject("Microsoft.XMLHTTP");
            } catch (e) {}
        }
    } 
    if (!HttPRequest) {
        alert('Cannot create XMLHTTP instance');
        return false;
    }
    var url = '/ขายสินค้า/';
    var pmeters = "tbarcode=" + encodeURI(document.getElementById("barcode").value) +
        "&taddcart=" + encodeURI(document.getElementById("addcart").value) +
        "&tcsrftoken=" + encodeURI(document.querySelector('[name=csrfmiddlewaretoken]').value);
    HttPRequest.open('POST',url,true);

    HttPRequest.setRequestHeader("X-CSRFToken", encodeURI(document.querySelector('[name=csrfmiddlewaretoken]').value));
    HttPRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    HttPRequest.send(pmeters);
    
    HttPRequest.onreadystatechange = function() {
        
        // Loading Request

        // Return Request
        if(HttPRequest.readyState == 4)
        {
            var Jsonresponse = JSON.parse(HttPRequest.responseText);
            
            if(Jsonresponse.status == 'Y') {
                window.top.location.reload();
            } else if(Jsonresponse.status == 'N') {
                toastr.error(Jsonresponse.alertify)
            } else {
                toastr.error(HttPRequest.responseText)
            }
        }
    }
}

function doCallDelCartID(id) {
    HttPRequest = false;
    if (window.XMLHttpRequest) { // Mozilla, Safari,...
        HttPRequest = new XMLHttpRequest();
        if (HttPRequest.overrideMimeType) {
            HttPRequest.overrideMimeType('text/html');
        }
    } else if (window.ActiveXObject) { // IE
        try {
            HttPRequest = new ActiveXObject("Msxml2.XMLHTTP");
        } catch (e) {
            try {
                HttPRequest = new ActiveXObject("Microsoft.XMLHTTP");
            } catch (e) {}
        }
    } 
    if (!HttPRequest) {
        alert('Cannot create XMLHTTP instance');
        return false;
    }
    var url = '/ขายสินค้า/';
    var pmeters = "tid=" + id +
        "&tdel_id=" + encodeURI(document.getElementById("del_id").value) +
        "&tcsrftoken=" + encodeURI(document.querySelector('[name=csrfmiddlewaretoken]').value);
    HttPRequest.open('POST',url,true);

    HttPRequest.setRequestHeader("X-CSRFToken", encodeURI(document.querySelector('[name=csrfmiddlewaretoken]').value));
    HttPRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    HttPRequest.send(pmeters);
    
    HttPRequest.onreadystatechange = function() {
        
        // Loading Request

        // Return Request
        if(HttPRequest.readyState == 4)
        {
            var Jsonresponse = JSON.parse(HttPRequest.responseText);
            
            if(Jsonresponse.status == 'Y') {
                window.top.location.reload();
            } else if(Jsonresponse.status == 'N') {
                toastr.error(Jsonresponse.alertify)
            } else {
                toastr.error(HttPRequest.responseText)
            }
        }
    }
}

function doCallDelCartAll() {
    HttPRequest = false;
    if (window.XMLHttpRequest) { // Mozilla, Safari,...
        HttPRequest = new XMLHttpRequest();
        if (HttPRequest.overrideMimeType) {
            HttPRequest.overrideMimeType('text/html');
        }
    } else if (window.ActiveXObject) { // IE
        try {
            HttPRequest = new ActiveXObject("Msxml2.XMLHTTP");
        } catch (e) {
            try {
                HttPRequest = new ActiveXObject("Microsoft.XMLHTTP");
            } catch (e) {}
        }
    } 
    if (!HttPRequest) {
        alert('Cannot create XMLHTTP instance');
        return false;
    }
    var url = '/ขายสินค้า/';
    var pmeters = "&tdel_all=" + encodeURI(document.getElementById("del_all").value) +
        "&tcsrftoken=" + encodeURI(document.querySelector('[name=csrfmiddlewaretoken]').value);
    HttPRequest.open('POST',url,true);

    HttPRequest.setRequestHeader("X-CSRFToken", encodeURI(document.querySelector('[name=csrfmiddlewaretoken]').value));
    HttPRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    HttPRequest.send(pmeters);
    
    HttPRequest.onreadystatechange = function() {
        
        // Loading Request

        // Return Request
        if(HttPRequest.readyState == 4)
        {
            var Jsonresponse = JSON.parse(HttPRequest.responseText);
            
            if(Jsonresponse.status == 'Y') {
                window.top.location.reload();
            } else if(Jsonresponse.status == 'N') {
                toastr.error(Jsonresponse.alertify)
            } else {
                toastr.error(HttPRequest.responseText)
            }
        }
    }
}

function doCallSellProduct() {
    HttPRequest = false;
    if (window.XMLHttpRequest) { // Mozilla, Safari,...
        HttPRequest = new XMLHttpRequest();
        if (HttPRequest.overrideMimeType) {
            HttPRequest.overrideMimeType('text/html');
        }
    } else if (window.ActiveXObject) { // IE
        try {
            HttPRequest = new ActiveXObject("Msxml2.XMLHTTP");
        } catch (e) {
            try {
                HttPRequest = new ActiveXObject("Microsoft.XMLHTTP");
            } catch (e) {}
        }
    } 
    if (!HttPRequest) {
        alert('Cannot create XMLHTTP instance');
        return false;
    }
    var url = '/ขายสินค้า/';
    var pmeters = "&tmember=" + encodeURI(document.getElementById("member").value) +
        "&ttype=" + encodeURI(document.getElementById("type").value) +
        "&tcash=" + encodeURI(document.getElementById("cash").value) +
        "&ttransfer=" + encodeURI(document.getElementById("transfer").value) +
        "&tdiscount=" + encodeURI(document.getElementById("discount").value) +
        "&tsellproduct=" + encodeURI(document.getElementById("sellproduct").value) +
        "&tcsrftoken=" + encodeURI(document.querySelector('[name=csrfmiddlewaretoken]').value);
    HttPRequest.open('POST',url,true);

    HttPRequest.setRequestHeader("X-CSRFToken", encodeURI(document.querySelector('[name=csrfmiddlewaretoken]').value));
    HttPRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    HttPRequest.send(pmeters);
    
    HttPRequest.onreadystatechange = function() {
        
        // Loading Request

        // Return Request
        if(HttPRequest.readyState == 4)
        {
            var Jsonresponse = JSON.parse(HttPRequest.responseText);
            
            if(Jsonresponse.status == 'Y') {
                window.location = Jsonresponse.url;
            } else if(Jsonresponse.status == 'N') {
                toastr.error(Jsonresponse.alertify)
            } else {
                toastr.error(HttPRequest.responseText)
            }
        }
    }
}